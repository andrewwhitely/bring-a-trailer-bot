<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Discord BAT Bot Preview</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
          sans-serif;
        background-color: #36393f;
        color: #dcddde;
        margin: 0;
        padding: 20px;
      }

      .discord-container {
        max-width: 600px;
        margin: 0 auto;
        background-color: #2f3136;
        border-radius: 8px;
        padding: 20px;
      }

      .discord-embed {
        background-color: #2f3136;
        border-left: 4px solid #ff6b35;
        border-radius: 4px;
        padding: 12px;
        margin: 8px 0;
      }

      .embed-title {
        color: #ffffff;
        font-weight: 600;
        font-size: 16px;
        padding-bottom: 16px;
        text-decoration: none;
      }

      .embed-title:hover {
        text-decoration: underline;
      }

      .embed-description {
        color: #dcddde;
        font-size: 14px;
        line-height: 1.4;
        margin: 16px 0;
      }

      .embed-image {
        max-width: 100%;
        border-radius: 4px;
        margin: 8px 0;
      }

      .embed-footer {
        display: flex;
        align-items: center;
        font-size: 12px;
        color: #72767d;
        margin-top: 8px;
      }

      .embed-footer-icon {
        width: 16px;
        height: 16px;
        margin-right: 6px;
        border-radius: 2px;
      }

      .embed-timestamp {
        color: #72767d;
        font-size: 12px;
        margin-top: 4px;
      }

      .controls {
        background-color: #2f3136;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
      }

      .control-group {
        margin-bottom: 15px;
      }

      label {
        display: block;
        margin-bottom: 5px;
        color: #dcddde;
        font-weight: 500;
      }

      input,
      textarea {
        width: 100%;
        padding: 8px;
        border: 1px solid #40444b;
        border-radius: 4px;
        background-color: #40444b;
        color: #dcddde;
        font-size: 14px;
      }

      button {
        background-color: #5865f2;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
      }

      button:hover {
        background-color: #4752c4;
      }

      .live-preview {
        margin-top: 20px;
      }

      .preview-label {
        color: #72767d;
        font-size: 12px;
        margin-bottom: 8px;
        text-transform: uppercase;
        font-weight: 600;
      }
    </style>
  </head>
  <body>
    <div class="discord-container">
      <div class="controls">
        <h2>Discord BAT Bot Preview</h2>
        <p>Customize the embed to see how it will look in Discord:</p>

        <div class="control-group">
          <label for="title">Title:</label>
          <input
            type="text"
            id="title"
            value="1973 BMW R75/5 LWB w/Cozy Rocket Sidecar at No Reserve"
          />
        </div>

        <div class="control-group">
          <label for="link">Link:</label>
          <input
            type="url"
            id="link"
            value="https://bringatrailer.com/listing/1973-bmw-r75-5-39/"
          />
        </div>

        <div class="control-group">
          <label for="description">Description:</label>
          <textarea id="description" rows="4">
This 1973 BMW R75/5 is a long wheelbase example that was acquired by the seller in 2010 and has been maintained with regular service including oil changes, valve adjustments, and carburetor rebuilds. The bike is powered by a 745cc opposed-twin engine paired with a 4-speed transmission and features a Cozy Rocket sidecar that was reportedly custom-built for this motorcycle.</textarea
          >
        </div>

        <div class="control-group">
          <label for="image">Image URL:</label>
          <input
            type="url"
            id="image"
            value="https://bringatrailer.com/wp-content/uploads/2025/07/1973_bmw_r75-5_dsc1944-19347.jpg?w=620&resize=620%2C413"
          />
        </div>

        <div class="control-group">
          <label for="timestamp">Timestamp:</label>
          <input
            type="datetime-local"
            id="timestamp"
            value="2025-08-07T15:15:13"
          />
        </div>

        <button onclick="updatePreview()">Update Preview</button>
        <button onclick="loadLatestListing()">Load Latest Listing</button>
      </div>

      <div class="live-preview">
        <div class="preview-label">Discord Preview:</div>
        <div class="discord-embed" id="embed-preview">
          <!-- Preview will be generated here -->
        </div>
      </div>
    </div>

    <script>
      function updatePreview() {
        const title = document.getElementById('title').value;
        const link = document.getElementById('link').value;
        const description = document.getElementById('description').value;
        const image = document.getElementById('image').value;
        const timestamp = document.getElementById('timestamp').value;

        const embedHtml = `
                <a href="${link}" class="embed-title">${title}</a>
                <div class="embed-description">${description}</div>
                ${
                  image
                    ? `<img src="${image}" alt="Listing Image" class="embed-image" onerror="this.style.display='none'">`
                    : ''
                }
                <div class="embed-timestamp">${new Date(
                  timestamp
                ).toLocaleString()}</div>
                <div class="embed-footer">
                    <img src="https://bringatrailer.com/favicon.ico" alt="BaT" class="embed-footer-icon">
                    Bring a Trailer
                </div>
            `;

        document.getElementById('embed-preview').innerHTML = embedHtml;
      }

      async function loadLatestListing() {
        try {
          const response = await fetch('https://bringatrailer.com/feed/');
          const text = await response.text();

          // Simple RSS parsing
          const itemMatch = text.match(/<item>([\s\S]*?)<\/item>/);
          if (itemMatch) {
            const itemContent = itemMatch[1];

            function extractTag(content, tagName) {
              const regex = new RegExp(
                `<${tagName}[^>]*>([\\s\\S]*?)<\\/${tagName}>`,
                'i'
              );
              const match = content.match(regex);
              return match ? match[1].trim() : '';
            }

            function decodeXMLEntities(text) {
              if (!text) return '';
              return text
                .replace(/&amp;/g, '&')
                .replace(/&lt;/g, '<')
                .replace(/&gt;/g, '>')
                .replace(/&quot;/g, '"')
                .replace(/&#39;/g, "'")
                .replace(/&apos;/g, "'");
            }

            const title = decodeXMLEntities(extractTag(itemContent, 'title'));
            const link = decodeXMLEntities(extractTag(itemContent, 'link'));
            const description = decodeXMLEntities(
              extractTag(itemContent, 'description')
            );
            const pubDate = extractTag(itemContent, 'pubDate');
            const content =
              extractTag(itemContent, 'content:encoded') || description;

            // Extract image from content
            const imagePatterns = [
              /<img[^>]+src="([^"]+)"/i,
              /<img[^>]+src='([^']+)'/i,
              /background-image:\s*url\(['"]?([^'")\s]+)['"]?\)/i,
              /<meta[^>]+property="og:image"[^>]+content="([^"]+)"/i,
              /<meta[^>]+name="twitter:image"[^>]+content="([^"]+)"/i,
            ];

            let image = '';
            for (const pattern of imagePatterns) {
              const match = content.match(pattern);
              if (match && match[1]) {
                image = match[1];
                break;
              }
            }

            // Update form fields
            document.getElementById('title').value = title;
            document.getElementById('link').value = link;
            document.getElementById('description').value = description
              .replace(/<[^>]*>/g, '')
              .substring(0, 500);
            document.getElementById('image').value = image;
            document.getElementById('timestamp').value = new Date(pubDate)
              .toISOString()
              .slice(0, 16);

            updatePreview();
          }
        } catch (error) {
          console.error('Error loading latest listing:', error);
          alert('Error loading latest listing. Check console for details.');
        }
      }

      // Initialize preview
      updatePreview();
    </script>
  </body>
</html>
